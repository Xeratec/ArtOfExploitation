/**
* @file raw_tcpsniff.h
* @author Philip Wiese
* @date 03 Okt 2016
* @brief Sniffs raw TCP packages and dumps them
* 
*/

#define IMPORT_NETWORKING

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "toolbox.h"

int main(int argc, char *argv[]) {
	int i, recv_length, sockfd;
	u_char buffer[9000];
	
	if (argc<2) {
		printf("Usage: %s <packet_count>\n", argv[0]);
		exit(0);
	}
	
	if ((sockfd = socket(PF_INET, SOCK_RAW, IPPROTO_TCP))==-1)
		fatal("in main() while creating socket\n");
	
	for (i = 0; i<atoi(argv[1]); i++) {
		recv_length = recv(sockfd, buffer, 8000, 0);
		printf("Got a %d byte packet\n", recv_length);
		dump(buffer, recv_length);
	}
	return 0;
}
